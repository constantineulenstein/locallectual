<div class="messages-container to-be-darkened">

  <div class="recipient-info col-sm-4">
    <div class= "cover-by-popup-image-book chatter-photo ml-1" style="background-image: linear-gradient(rgba(0,0,0,0),rgba(0,0,0,0)), url(<%= @other_chatter.photo %>);">
    </div>
    <%#= cl_image_tag @other_chatter.photo, class: "chatter-photo ml-1 cover-by-popup-image-book" %>
    <h1><%= @other_chatter.first_name %> <%= @other_chatter.last_name %></h1>

    <h4><%= @other_chatter.gender %> â€¢ <%= @other_chatter.age %> </h4>

    <p><%= @other_chatter.bio %></p>
    <% if current_user.transactions.any? {|transaction| @other_chatter.transactions.include?(transaction) } %>
      <% @other_chatter.transactions.each do |transaction| %>
        <% if current_user.transactions.include?(transaction) %>
          <h3>Your next meeting:</h3>
          <p>Date: <%= transaction.date.strftime("%A, %d %b %Y %l:%M %p") %></p>
          <p>Location: <%= transaction.location %></p>
        <% end %>
      <% end %>
    <% else %>
      <%= link_to "book person", "#", class: "friendship-request-button" %>
    <% end %>
  </div>

  <div class="message-list col-sm-8">
    <%= @conversation.subject %>

    <% receipts = @conversation.receipts_for current_user%>

    <div class="conversations-container">
      <% receipts.reverse.each do |receipt| %>
        <% if receipt.message.sender_id == current_user.id %>
          <div class="single-message-container r">
            <div class="card-conversation cover-by-popup-box">
              <div class="card-product-infos">
                <p><%= User.find(receipt.message.sender_id).first_name %></p>
                <h4> <%= message = receipt.message.body %></h4>
              </div>
            </div>
          </div>
        <% else %>
          <div class="single-message-container l">
            <div class="card-conversation cover-by-popup-box">
              <div class="card-product-infos">
                <p><%= User.find(receipt.message.sender_id).first_name %></p>
                <h4> <%= message = receipt.message.body %></h4>
              </div>
            </div>
          </div>
        <% end %>


      <% end %>
      <div class="single-message-container r">
        <div class="card-conversation cover-by-popup-box">
        <%= form_tag(reply_path(id: @conversation.id), method: :get) do %>
          <%= text_field_tag :send_message %>
          <%= submit_tag "Send" %>
        <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Will only pop up if meeting takes place -->
<div class="container w-50 border-radius p-5 friend-request-field">
  <h3 class="my-3">Arrange meeting</h3>
  <%= simple_form_for(@transaction, url: conversation_transactions_path(@conversation), method: :post) do |f| %>
    <%= f.error_notification %>
    <div class="form-inputs">
      <%= f.input :date, as: :string, input_html: {class: "datepicker bg-white"} %>
      <%= f.input :location, as: :string %>
    </div>
    <div class="form-actions">
      <%= f.button :submit, "Book", class: "btn btn-outline-light" %>
    </div>
  <% end %>
  <%= link_to conversation_path(@conversation) do %>
    <i class="fas fa-times cancel-cross"></i>
  <% end %>
</div>

<script>
  const chatter = <%= @other_chatter.to_json.to_s.html_safe %>
</script>

