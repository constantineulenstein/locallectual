<div class="navbar navbar-expand-sm navbar-light navbar-lewagon">
  <div class="container">
    <div>
    <!-- brand logo -->
    <%= link_to root_path, class: "navbar-brand" do %>
      <%= image_tag "https://res.cloudinary.com/dd8gqkm50/image/upload/v1575428610/locallectuallogo_ocbhoy.png" %>
    <% end %>
    <% if user_signed_in? %>
          <%= link_to "Forum", forums_path, class: "navbar-text mt-2 mx-3" %>
    <% end %>

    </div>
    <!-- navbar paths -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <% if user_signed_in? %>

          <!-- counts number of unresponded friend requests inside connection_count variable -->
          <% connection_count = 0 %>
          <% requests = [] %>
          <% current_user.locallect.friendships.each do |friendship| %>
            <% requests << friendship if friendship.approved == false && friendship.declined == false %>
          <% end %>
          <% requests.each { connection_count += 1 } %>

          <!-- counts number of unopened messages inside message_count variable -->
          <% message_count = 0 %>
          <% unread_messages = [] %>
          <% current_user.mailbox.receipts.each do |message| %>
            <% unread_messages << message if message.is_read == false && message.mailbox_type == "inbox" %>
          <% end %>
          <% unread_messages.each { message_count += 1 } %>

          <%= link_to "Messages", conversations_path, class: "navbar-text mt-2 mr-1 ml-3" %>
          <% if message_count.nil? == false %>
            <% if message_count > 0 %>
              <span class="badge badge-danger h-25"><%= message_count %></span>
            <% end %>
          <% end %>
          <%= link_to "Connections", locallect_friendships_path(current_user.id), class: "navbar-text mt-2 mr-1 ml-3" %>
          <% if connection_count > 0 %>
            <span class="badge badge-danger h-25"><%= connection_count %></span>
          <% end %>
          <li class="nav-item dropdown ml-4">
            <%= current_user.photo.nil? ? (image_tag "user-solid.svg", class: "avatar dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false) : (cl_image_tag current_user.photo, width: 60, height: 60, crop: :fill, class: "avatar dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false) %>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
              <%= link_to "View your profile", locallect_path(current_user), class: "dropdown-item" %>
              <%= link_to "Edit your profile", edit_user_registration_path, class: "dropdown-item" %>
              <%= link_to "Log out", destroy_user_session_path, method: :delete, class: "dropdown-item" %>
            </div>
          </li>
        <% else %>
          <!-- if not signed in -->
          <li class="nav-item">
            <%= link_to "Login", new_user_session_path, class: "nav-link" %>
          </li>
          <li class="nav-item">
            <%= link_to "Signup", new_user_registration_path, class: "nav-link" %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</div>
</div>
